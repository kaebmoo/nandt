
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main, production ]
  pull_request:
    branches: [ main, production ]

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Build job for documentation/static site
  build-docs:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/production'
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install mkdocs mkdocs-material  # สำหรับสร้าง documentation
          
      - name: Generate documentation
        run: |
          # สร้าง documentation จาก Flask app
          mkdir -p docs/_static
          mkdir -p docs/_templates
          
          # สร้างหน้า index.html สำหรับ documentation
          cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="th">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>TeamUp Calendar - Dialysis Scheduler</title>
              <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
              <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
          </head>
          <body>
              <div class="container mt-5">
                  <div class="row justify-content-center">
                      <div class="col-md-8">
                          <div class="text-center mb-5">
                              <h1 class="display-4">
                                  <i class="fas fa-calendar-alt text-primary"></i>
                                  TeamUp Calendar
                              </h1>
                              <p class="lead">ระบบจัดการตารางนัดหมายฟอกไต</p>
                          </div>
                          
                          <div class="card">
                              <div class="card-body">
                                  <h3>คุณสมบัติของระบบ</h3>
                                  <ul class="list-group list-group-flush">
                                      <li class="list-group-item">
                                          <i class="fas fa-plus-circle text-success me-2"></i>
                                          สร้างนัดหมายฟอกไตใหม่
                                      </li>
                                      <li class="list-group-item">
                                          <i class="fas fa-calendar-check text-info me-2"></i>
                                          ดูรายการนัดหมายตามวันที่
                                      </li>
                                      <li class="list-group-item">
                                          <i class="fas fa-edit text-warning me-2"></i>
                                          อัปเดตสถานะการนัดหมาย
                                      </li>
                                      <li class="list-group-item">
                                          <i class="fas fa-file-import text-primary me-2"></i>
                                          นำเข้าข้อมูลจากไฟล์ CSV
                                      </li>
                                      <li class="list-group-item">
                                          <i class="fas fa-repeat text-secondary me-2"></i>
                                          สร้างนัดหมายซ้ำแบบอัตโนมัติ
                                      </li>
                                  </ul>
                              </div>
                          </div>
                          
                          <div class="row mt-4">
                              <div class="col-md-6">
                                  <div class="card">
                                      <div class="card-body text-center">
                                          <h5>การติดตั้ง</h5>
                                          <p>Clone repository และติดตั้ง dependencies</p>
                                          <code>git clone &lt;repository-url&gt;</code>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-md-6">
                                  <div class="card">
                                      <div class="card-body text-center">
                                          <h5>การใช้งาน</h5>
                                          <p>ตั้งค่า TeamUp API และเริ่มใช้งาน</p>
                                          <code>python app.py</code>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          
                          <div class="card mt-4">
                              <div class="card-body">
                                  <h5>ลิงค์ที่เกี่ยวข้อง</h5>
                                  <div class="d-flex justify-content-center gap-3">
                                      <a href="https://github.com/your-username/your-repo" class="btn btn-outline-primary">
                                          <i class="fab fa-github me-2"></i>GitHub Repository
                                      </a>
                                      <a href="https://teamup.com" class="btn btn-outline-success">
                                          <i class="fas fa-calendar me-2"></i>TeamUp Calendar
                                      </a>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </body>
          </html>
          EOF
          
      - name: Setup Pages
        uses: actions/configure-pages@v3
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: './docs'

  # Deployment job
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build-docs
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
